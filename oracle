Perfeito! Aqui estÃ¡ a documentaÃ§Ã£o completa em Markdown:

---

# ğŸ›¡ï¸ DocumentaÃ§Ã£o de Infraestrutura
**Oracle Cloud Free Tier - Multi-Instance VPN & Security Setup**

---

## 1. VisÃ£o Geral da Infraestrutura

Infraestrutura distribuÃ­da em 3 instÃ¢ncias VPS no Oracle Cloud Free Tier (~1GB RAM, 1 vCPU cada).

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â˜ï¸  ORACLE CLOUD FREE TIER                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  ğŸ–¥ï¸ VPS 1     â”‚   â”‚  ğŸ–¥ï¸ VPS 2     â”‚   â”‚  ğŸ–¥ï¸ VPS 3     â”‚        â”‚
â”‚  â”‚  (Backup)    â”‚   â”‚  (Principal) â”‚   â”‚  (API/Web)   â”‚        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚  â”‚ â€¢ WireGuard  â”‚   â”‚ â€¢ WireGuard  â”‚   â”‚ â€¢ Nginx      â”‚        â”‚
â”‚  â”‚              â”‚   â”‚ â€¢ AdGuard    â”‚   â”‚ â€¢ Docker     â”‚        â”‚
â”‚  â”‚              â”‚   â”‚ â€¢ CrowdSec   â”‚   â”‚ â€¢ OTP API    â”‚        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚  â”‚ ğŸ“¡ 51820/UDP â”‚   â”‚ ğŸ“¡ 51820/UDP â”‚   â”‚ ğŸ“¡ 80,443,8080â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                  â”‚                  â”‚                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                            â”‚                                    â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                  â”‚  ğŸ”’ VPN Network   â”‚                          â”‚
â”‚                  â”‚  10.1.141.0/24    â”‚                          â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              â”‚              â”‚
        â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
        â”‚ ğŸ’» Fedora â”‚  â”‚ ğŸ“± Mobile â”‚  â”‚ ğŸ’» Chrome â”‚
        â”‚ 10.1.141.2â”‚  â”‚           â”‚  â”‚ 10.1.141.3â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| InstÃ¢ncia | FunÃ§Ã£o | ServiÃ§os | Portas | Status |
|-----------|--------|----------|--------|--------|
| **VPS 1** (Backup) | VPN de redundÃ¢ncia | WireGuard | 51820/UDP | âœ… Ativo |
| **VPS 2** (Principal) | VPN + DNS + SeguranÃ§a | WireGuard, AdGuard Home, CrowdSec | 51820/UDP | âœ… Ativo |
| **VPS 3** (API/Web) | API e interface web | OpenTripPlanner, Nginx, Docker | 80, 443, 8080/TCP | ğŸŒ PÃºblico |

---

## 2. ConfiguraÃ§Ã£o VPN (WireGuard)

**Rede VPN:** `10.1.141.0/24`  
**Porta PadrÃ£o:** `51820/UDP`

### Dispositivos Conectados

| Dispositivo | IP VPN | FunÃ§Ã£o |
|-------------|--------|--------|
| ğŸ–¥ï¸ VPS Principal | `10.1.141.1` | Gateway/Servidor |
| ğŸ’» Fedora | `10.1.141.2` | Cliente Desktop |
| ğŸ“± Chromebook | `10.1.141.3` | Cliente MÃ³vel |

### Exemplo de ConfiguraÃ§Ã£o do Cliente

```ini
# /etc/wireguard/wg0.conf

[Interface]
PrivateKey = <CHAVE_PRIVADA_DO_CLIENTE>
Address = 10.1.141.3/32
DNS = 10.1.141.1

[Peer]
PublicKey = <CHAVE_PUBLICA_DO_SERVIDOR>
AllowedIPs = 0.0.0.0/0, ::/0
Endpoint = <IP_PUBLICO_VPS>:51820
PersistentKeepalive = 25
```

> âš ï¸ **Importante:** Substitua as chaves e o IP pÃºblico pelos valores reais.

---

## 3. ServiÃ§os e Acessos

| ServiÃ§o | URL/EndereÃ§o | Acesso |
|---------|--------------|--------|
| ğŸ›¡ï¸ **AdGuard Home Dashboard** | `http://10.1.141.1:3000` | ğŸ”’ Via VPN |
| ğŸ” **DNS AdGuard** | `10.1.141.1` | ğŸ”’ Via VPN |
| ğŸ—ºï¸ **OpenTripPlanner API** | `http://[IP-PÃšBLICO]:8080/otp` | ğŸŒ PÃºblico |
| ğŸŒ **Interface Web** | `https://[DOMÃNIO]` | ğŸŒ PÃºblico |

> âœ… **Dica:** Configure `10.1.141.1` como DNS nos dispositivos conectados Ã  VPN para usar a filtragem do AdGuard.

---

## 4. Camadas de SeguranÃ§a

| Camada | DescriÃ§Ã£o |
|--------|-----------|
| ğŸ§± **Firewall (iptables/nftables)** | Regras de controle de trÃ¡fego, apenas portas necessÃ¡rias expostas |
| ğŸ¤– **CrowdSec** | DetecÃ§Ã£o de intrusÃ£o colaborativa com blocklist de ~15.000 IPs maliciosos |
| ğŸ”’ **VPN WireGuard** | TÃºnel criptografado para acesso interno seguro |
| ğŸ”„ **Nginx Reverse Proxy** | SSL/TLS, headers de seguranÃ§a, rate limiting |

---

## 5. Portas Abertas

| Porta | Protocolo | ServiÃ§o | InstÃ¢ncia | ExposiÃ§Ã£o |
|-------|-----------|---------|-----------|-----------|
| 51820 | UDP | WireGuard | VPS 1, VPS 2 | ğŸŒ PÃºblico |
| 80 | TCP | HTTP (Nginx) | VPS 3 | ğŸŒ PÃºblico |
| 443 | TCP | HTTPS (Nginx) | VPS 3 | ğŸŒ PÃºblico |
| 8080 | TCP | OpenTripPlanner API | VPS 3 | ğŸŒ PÃºblico |
| 3000 | TCP | AdGuard Home | VPS 2 | ğŸ”’ VPN only |

---

## 6. Comandos Ãšteis

### WireGuard
```bash
wg show                    # Status da interface VPN
wg-quick up wg0            # Iniciar VPN
wg-quick down wg0          # Parar VPN
wg genkey | tee privatekey | wg pubkey > publickey  # Gerar chaves
```

### CrowdSec
```bash
cscli decisions list       # Ver IPs bloqueados
cscli metrics              # MÃ©tricas do sistema
cscli hub update           # Atualizar collections
cscli bouncers list        # Ver bouncers ativos
cscli alerts list          # Ver alertas recentes
```

### Docker
```bash
docker ps                  # Containers em execuÃ§Ã£o
docker logs <container>    # Ver logs
docker-compose up -d       # Iniciar serviÃ§os
docker-compose down        # Parar serviÃ§os
docker stats               # Uso de recursos
```

### Firewall
```bash
iptables -L -n -v          # Listar regras (iptables)
nft list ruleset           # Listar regras (nftables)
ss -tulnp                  # Portas em uso
```

---

## 7. RecomendaÃ§Ãµes de SeguranÃ§a

### ğŸ”´ Prioridade Alta

- **Instalar CrowdSec no VPS 3** â€” A API estÃ¡ exposta publicamente na porta 8080, vulnerÃ¡vel a scans e ataques automatizados
- **Restringir porta 8080 via VPN** â€” Se possÃ­vel, mover o acesso da API para dentro da VPN

### ğŸŸ¡ Prioridade MÃ©dia

- **Manter atualizaÃ§Ãµes regulares** â€” `apt update && apt upgrade` semanalmente
- **Monitorar logs** â€” Verificar `/var/log/` e logs do CrowdSec regularmente
- **Configurar fail2ban** â€” Como camada adicional ao CrowdSec

### ğŸŸ¢ Prioridade Baixa

- **Backup das configuraÃ§Ãµes** â€” Exportar configs do WireGuard e AdGuard periodicamente
- **Documentar alteraÃ§Ãµes** â€” Manter changelog das modificaÃ§Ãµes na infraestrutura
- **Testar redundÃ¢ncia** â€” Verificar se VPS 1 assume em caso de falha do VPS 2

---

## Resumo RÃ¡pido

```
VPN Principal:    <IP-PÃšBLICO-VPS2>:51820
VPN Backup:       <IP-PÃšBLICO-VPS1>:51820
DNS (via VPN):    10.1.141.1
AdGuard:          http://10.1.141.1:3000 (VPN)
API:              http://<IP-VPS3>:8080/otp
Web:              https://<DOMÃNIO>
```

---

*Ãšltima atualizaÃ§Ã£o: Dezembro 2025*

---

Pronto! Se quiser que eu adicione mais alguma coisa ou ajuste algum detalhe especÃ­fico (como os IPs pÃºblicos reais), Ã© sÃ³ avisar! ğŸš€
